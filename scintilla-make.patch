--- scintilla/gtk/makefile.orig	2003-05-14 15:52:54.000000000 +0200
+++ scintilla/gtk/makefile	2003-05-25 18:47:15.000000000 +0200
@@ -5,7 +5,7 @@
 # GNU make does not like \r\n line endings so should be saved to CVS in binary form.
 # To build for GTK+ 2, define GTK2 on the make command line.
 
-.SUFFIXES: .cxx .o .h .a
+.SUFFIXES: .cxx .o .h .a .lo .la
 CC = g++
 AR = ar
 RANLIB = touch
@@ -16,7 +16,7 @@
 RANLIB = ranlib
 endif
 
-COMPLIB=../bin/scintilla.a
+COMPLIB=../bin/libscintilla.la
 
 vpath %.h ../src ../include
 vpath %.cxx ../src
@@ -31,27 +31,29 @@
 endif
 
 ifdef DEBUG
-CXXFLAGS=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS=-DDEBUG $(OPTFLAGS) $(CXXBASEFLAGS) $(THREADFLAGS)
 else
-CXXFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS=-DNDEBUG $(OPTFLAGS) $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
 
 ifdef GTK2
 CONFIGFLAGS=pkg-config --cflags gtk+-2.0
+LIBCONFIG=pkg-config --libs gtk+-2.0 gthread-2.0
 else
 CONFIGFLAGS=gtk-config --cflags
+LIBCONFIG=gtk-config --libs ; glib-config --libs gthread
 endif
 
-.cxx.o:
-	$(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
+.cxx.lo:
+	libtool --mode=compile $(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
 
 #++Autogenerated -- run src/LexGen.py to regenerate
-#**LEXOBJS=\\\n\(\*.o \)
+#**LEXOBJS=\\\n\(\*.lo \)
 LEXOBJS=\
-LexAda.o LexAsm.o LexAVE.o LexBaan.o LexBullant.o LexConf.o LexCPP.o \
-LexCrontab.o LexCSS.o LexEiffel.o LexEScript.o LexFortran.o LexHTML.o \
-LexLisp.o LexLout.o LexLua.o LexMatlab.o LexOthers.o LexPascal.o LexPerl.o \
-LexPOV.o LexPython.o LexRuby.o LexSQL.o LexVB.o 
+LexAda.lo LexAsm.lo LexAVE.lo LexBaan.lo LexBullant.lo LexConf.lo LexCPP.lo \
+LexCrontab.lo LexCSS.lo LexEiffel.lo LexEScript.lo LexFortran.lo LexHTML.lo \
+LexLisp.lo LexLout.lo LexLua.lo LexMatlab.lo LexOthers.lo LexPascal.lo LexPerl.lo \
+LexPOV.lo LexPython.lo LexRuby.lo LexSQL.lo LexVB.lo 
 #--Autogenerated -- end of automatically generated section
 
 # The LEXOBJS have to be treated specially as the functions in them are not called from external code
@@ -64,12 +66,15 @@
 deps:
 	$(CC) -MM `$(CONFIGFLAGS)` $(CXXFLAGS) *.cxx ../src/*.cxx >deps.mak
 
-$(COMPLIB): DocumentAccessor.o WindowAccessor.o KeyWords.o StyleContext.o Document.o CallTip.o \
-	ScintillaBase.o ContractionState.o Editor.o ExternalLexer.o PropSet.o PlatGTK.o \
-	KeyMap.o LineMarker.o ScintillaGTK.o CellBuffer.o ViewStyle.o \
-	RESearch.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o
-	$(AR) rc $@ $^
-	$(RANLIB) $@
+$(COMPLIB): DocumentAccessor.lo WindowAccessor.lo KeyWords.lo StyleContext.lo Document.lo CallTip.lo \
+	ScintillaBase.lo ContractionState.lo Editor.lo ExternalLexer.lo PropSet.lo PlatGTK.lo \
+	KeyMap.lo LineMarker.lo ScintillaGTK.lo CellBuffer.lo ViewStyle.lo \
+	RESearch.lo Style.lo Indicator.lo AutoComplete.lo UniConversion.lo XPM.lo $(LEXOBJS)
+	libtool --mode=link $(CC) -o $@ $^ -rpath $(libdir) `$(LIBCONFIG)`
+
+install: $(COMPLIB)
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(COMPLIB) $(DESTDIR)$(libdir)
 
 # Automatically generate header dependencies with "make deps"
 include deps.mak
