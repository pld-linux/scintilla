--- scintilla/gtk/makefile.orig	2003-12-24 00:45:12.000000000 +0100
+++ scintilla/gtk/makefile	2004-02-09 00:11:31.359015568 +0100
@@ -7,7 +7,7 @@
 # To force GTK+ 2 build, define GTK2 on the make command line.
 # To force GTK+ 1 build, define GTK1 on the make command line.
 
-.SUFFIXES: .cxx .o .h .a
+.SUFFIXES: .cxx .o .h .a .lo .la
 CC = g++
 AR = ar
 RANLIB = touch
@@ -16,7 +16,7 @@
 RANLIB = ranlib
 endif
 
-COMPLIB=../bin/scintilla.a
+COMPLIB=../bin/libscintilla.la
 
 vpath %.h ../src ../include
 vpath %.cxx ../src
@@ -31,18 +31,20 @@
 endif
 
 ifdef DEBUG
-CXXFLAGS=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS=-DDEBUG $(OPTFLAGS) $(CXXBASEFLAGS) $(THREADFLAGS)
 else
-CXXFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS=-DNDEBUG $(OPTFLAGS) $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
 
 # If explicit setting of GTK1 or GTK2 then use that else look for
 # pkg-config which is an OK indication that GTK2 is available
 ifdef GTK2
 CONFIGFLAGS=pkg-config --cflags gtk+-2.0
+LIBCONFIG=pkg-config --libs gtk+-2.0 gthread-2.0
 else
 ifdef GTK1
 CONFIGFLAGS=gtk-config --cflags
+LIBCONFIG=gtk-config --libs ; glib-config --libs gthread
 else
 ifneq (,$(findstring /,$(shell whereis pkg-config)))
 CONFIGFLAGS=pkg-config --cflags gtk+-2.0
@@ -53,17 +55,17 @@
 endif
 
-.cxx.o:
-	$(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
+.cxx.lo:
+	libtool --mode=compile $(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
 
 #++Autogenerated -- run src/LexGen.py to regenerate
-#**LEXOBJS=\\\n\(\*.o \)
+#**LEXOBJS=\\\n\(\*.lo \)
 LEXOBJS=\
-LexAda.o LexAsm.o LexAVE.o LexBaan.o LexBullant.o LexCLW.o LexConf.o LexCPP.o \
-LexCrontab.o LexCSS.o LexEiffel.o LexErlang.o LexEScript.o LexForth.o \
-LexFortran.o LexHTML.o LexLisp.o LexLout.o LexLua.o LexMatlab.o LexMetapost.o \
-LexMMIXAL.o LexMPT.o LexNsis.o LexOthers.o LexPascal.o LexPB.o LexPerl.o \
-LexPOV.o LexPS.o LexPython.o LexRuby.o LexScriptol.o LexSQL.o LexTeX.o LexVB.o \
-LexYAML.o
+LexAda.lo LexAsm.lo LexAVE.lo LexBaan.lo LexBullant.lo LexCLW.lo LexConf.lo LexCPP.lo \
+LexCrontab.lo LexCSS.lo LexEiffel.lo LexErlang.lo LexEScript.lo LexForth.lo \
+LexFortran.lo LexHTML.lo LexLisp.lo LexLout.lo LexLua.lo LexMatlab.lo LexMetapost.lo \
+LexMMIXAL.lo LexMPT.lo LexNsis.lo LexOthers.lo LexPascal.lo LexPB.lo LexPerl.lo \
+LexPOV.lo LexPS.lo LexPython.lo LexRuby.lo LexScriptol.lo LexSQL.lo LexTeX.lo LexVB.lo \
+LexYAML.lo
 #--Autogenerated -- end of automatically generated section
 
 all: $(COMPLIB)
@@ -74,13 +76,16 @@
 deps:
 	$(CC) -MM `$(CONFIGFLAGS)` $(CXXFLAGS) *.cxx ../src/*.cxx >deps.mak
 
-$(COMPLIB): DocumentAccessor.o WindowAccessor.o KeyWords.o StyleContext.o Document.o CallTip.o \
-	ScintillaBase.o ContractionState.o Editor.o ExternalLexer.o PropSet.o PlatGTK.o \
-	KeyMap.o LineMarker.o ScintillaGTK.o CellBuffer.o ViewStyle.o \
-	RESearch.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o \
+$(COMPLIB): DocumentAccessor.lo WindowAccessor.lo KeyWords.lo StyleContext.lo Document.lo CallTip.lo \
+	ScintillaBase.lo ContractionState.lo Editor.lo ExternalLexer.lo PropSet.lo PlatGTK.lo \
+	KeyMap.lo LineMarker.lo ScintillaGTK.lo CellBuffer.lo ViewStyle.lo \
+	RESearch.lo Style.lo Indicator.lo AutoComplete.lo UniConversion.lo XPM.lo \
 	$(LEXOBJS)
-	$(AR) rc $@ $^
-	$(RANLIB) $@
+	libtool --mode=link $(CC) -o $@ $^ -rpath $(libdir) `$(LIBCONFIG)`
+
+install: $(COMPLIB)
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(COMPLIB) $(DESTDIR)$(libdir)
 
 # Automatically generate header dependencies with "make deps"
 include deps.mak
