--- scintilla/gtk/makefile.orig	2009-08-13 03:35:23.000000000 +0200
+++ scintilla/gtk/makefile	2009-10-23 11:56:42.738805415 +0200
@@ -7,7 +7,7 @@
 # To force GTK+ 2 build, define GTK2 on the make command line.
 # To force GTK+ 1 build, define GTK1 on the make command line.
 
-.SUFFIXES: .cxx .c .o .h .a
+.SUFFIXES: .cxx .c .o .h .a .lo .la
 CC = g++
 CCOMP = gcc
 AR = ar
@@ -17,7 +17,7 @@
 RANLIB = ranlib
 endif
 
-COMPLIB=../bin/scintilla.a
+COMPLIB=../bin/libscintilla.la
 
 vpath %.h ../src ../include
 vpath %.cxx ../src
@@ -32,7 +32,7 @@
 endif
 
 ifdef DEBUG
-CXXFLAGS=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS=-DDEBUG $(CXXBASEFLAGS) $(THREADFLAGS)
 else
 CXXFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
@@ -40,15 +40,15 @@
 # If explicit setting of GTK1 or GTK2 then use that else look for
 # pkg-config which is an OK indication that GTK2 is available
 ifdef GTK2
-CONFIGFLAGS:=$(shell pkg-config --cflags gtk+-2.0)
-MARSHALLER=scintilla-marshal.o
+CONFIGFLAGS:=pkg-config --cflags gtk+-2.0 gthread-2.0
+MARSHALLER=scintilla-marshal.lo
 else
 ifdef GTK1
 CONFIGFLAGS:=$(shell gtk-config --cflags)
 else
 ifneq (,$(findstring /,$(shell whereis pkg-config)))
-CONFIGFLAGS:=$(shell pkg-config --cflags gtk+-2.0)
-MARSHALLER=scintilla-marshal.o
+CONFIGFLAGS:=pkg-config --cflags gtk+-2.0 gthread-2.0
+MARSHALLER=scintilla-marshal.lo
 else
 CONFIGFLAGS:=$(shell gtk-config --cflags)
 endif
@@ -59,39 +59,46 @@
 	$(CC) $(CONFIGFLAGS) $(CXXFLAGS) -c $<
 .c.o:
 	$(CCOMP) $(CONFIGFLAGS) $(CXXFLAGS) -w -c $<
+.cxx.lo:
+	libtool --tag=CXX --mode=compile $(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
+.c.lo:
+	libtool --tag=CC --mode=compile $(CCOMP) `$(CONFIGFLAGS)` $(CXXFLAGS) -w -c $<
 
 #++Autogenerated -- run src/LexGen.py to regenerate
 #**LEXOBJS=\\\n\(\*.o \)
 LEXOBJS=\
-LexAbaqus.o LexAda.o LexAPDL.o LexAsm.o LexAsn1.o LexASY.o LexAU3.o LexAVE.o \
-LexBaan.o LexBash.o LexBasic.o LexBullant.o LexCaml.o LexCLW.o LexCmake.o \
-LexCOBOL.o LexConf.o LexCPP.o LexCrontab.o LexCsound.o LexCSS.o LexD.o \
-LexEiffel.o LexErlang.o LexEScript.o LexFlagship.o LexForth.o LexFortran.o \
-LexGAP.o LexGui4Cli.o LexHaskell.o LexHTML.o LexInno.o LexKix.o LexLisp.o \
-LexLout.o LexLua.o LexMagik.o LexMatlab.o LexMetapost.o LexMMIXAL.o LexMPT.o \
-LexMSSQL.o LexMySQL.o LexNimrod.o LexNsis.o LexOpal.o LexOthers.o LexPascal.o \
-LexPB.o LexPerl.o LexPLM.o LexPOV.o LexPowerPro.o LexPowerShell.o \
-LexProgress.o LexPS.o LexPython.o LexR.o LexRebol.o LexRuby.o LexScriptol.o \
-LexSmalltalk.o LexSML.o LexSorcus.o LexSpecman.o LexSpice.o LexSQL.o LexTACL.o \
-LexTADS3.o LexTAL.o LexTCL.o LexTeX.o LexVB.o LexVerilog.o LexVHDL.o LexYAML.o
+LexAbaqus.lo LexAda.lo LexAPDL.lo LexAsm.lo LexAsn1.lo LexASY.lo LexAU3.lo LexAVE.lo \
+LexBaan.lo LexBash.lo LexBasic.lo LexBullant.lo LexCaml.lo LexCLW.lo LexCmake.lo \
+LexCOBOL.lo LexConf.lo LexCPP.lo LexCrontab.lo LexCsound.lo LexCSS.lo LexD.lo \
+LexEiffel.lo LexErlang.lo LexEScript.lo LexFlagship.lo LexForth.lo LexFortran.lo \
+LexGAP.lo LexGui4Cli.lo LexHaskell.lo LexHTML.lo LexInno.lo LexKix.lo LexLisp.lo \
+LexLout.lo LexLua.lo LexMagik.lo LexMatlab.lo LexMetapost.lo LexMMIXAL.lo LexMPT.lo \
+LexMSSQL.lo LexMySQL.lo LexNimrod.lo LexNsis.lo LexOpal.lo LexOthers.lo LexPascal.lo \
+LexPB.lo LexPerl.lo LexPLM.lo LexPOV.lo LexPowerPro.lo LexPowerShell.lo \
+LexProgress.lo LexPS.lo LexPython.lo LexR.lo LexRebol.lo LexRuby.lo LexScriptol.lo \
+LexSmalltalk.lo LexSML.lo LexSorcus.lo LexSpecman.lo LexSpice.lo LexSQL.lo LexTACL.lo \
+LexTADS3.lo LexTAL.lo LexTCL.lo LexTeX.lo LexVB.lo LexVerilog.lo LexVHDL.lo LexYAML.lo
 #--Autogenerated -- end of automatically generated section
 
 all: $(COMPLIB)
 
 clean:
-	rm -f *.o $(COMPLIB)
+	rm -f *.o *.lo $(COMPLIB)
 
 deps:
 	$(CC) -MM $(CONFIGFLAGS) $(CXXFLAGS) *.cxx ../src/*.cxx | sed -e 's/\/usr.* //' | grep [a-zA-Z] >deps.mak
 
-$(COMPLIB): DocumentAccessor.o WindowAccessor.o KeyWords.o StyleContext.o \
-	CharClassify.o Decoration.o Document.o PerLine.o CallTip.o \
-	ScintillaBase.o ContractionState.o Editor.o ExternalLexer.o PropSet.o PlatGTK.o \
-	KeyMap.o LineMarker.o PositionCache.o ScintillaGTK.o CellBuffer.o ViewStyle.o \
-	RESearch.o RunStyles.o Selection.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o \
+$(COMPLIB): DocumentAccessor.lo WindowAccessor.lo KeyWords.lo StyleContext.lo \
+	CharClassify.lo Decoration.lo Document.lo PerLine.lo CallTip.lo \
+	ScintillaBase.lo ContractionState.lo Editor.lo ExternalLexer.lo PropSet.lo PlatGTK.lo \
+	KeyMap.lo LineMarker.lo PositionCache.lo ScintillaGTK.lo CellBuffer.lo ViewStyle.lo \
+	RESearch.lo RunStyles.lo Selection.lo Style.lo Indicator.lo AutoComplete.lo UniConversion.lo XPM.lo \
 	$(MARSHALLER) $(LEXOBJS)
-	$(AR) rc $@ $^
-	$(RANLIB) $@
+	libtool --tag=CXX --mode=link $(CC) -o $@ $^ -rpath $(libdir) `$(LIBCONFIG)`
+
+install: $(COMPLIB)
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(COMPLIB) $(DESTDIR)$(libdir)
 
 # Automatically generate header dependencies with "make deps"
 include deps.mak
